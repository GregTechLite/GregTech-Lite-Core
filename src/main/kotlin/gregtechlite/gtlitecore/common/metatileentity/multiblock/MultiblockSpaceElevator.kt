package gregtechlite.gtlitecore.common.metatileentity.multiblock

import codechicken.lib.render.CCRenderState
import codechicken.lib.render.pipeline.IVertexOperation
import codechicken.lib.vec.Matrix4
import gregtech.api.block.VariantBlock
import gregtech.api.capability.IEnergyContainer
import gregtech.api.capability.IOpticalComputationProvider
import gregtech.api.capability.impl.EnergyContainerList
import gregtech.api.metatileentity.MetaTileEntity
import gregtech.api.metatileentity.interfaces.IGregTechTileEntity
import gregtech.api.metatileentity.multiblock.IMultiblockPart
import gregtech.api.metatileentity.multiblock.MultiblockAbility.COMPUTATION_DATA_RECEPTION
import gregtech.api.metatileentity.multiblock.MultiblockAbility.EXPORT_FLUIDS
import gregtech.api.metatileentity.multiblock.MultiblockAbility.EXPORT_ITEMS
import gregtech.api.metatileentity.multiblock.MultiblockAbility.IMPORT_FLUIDS
import gregtech.api.metatileentity.multiblock.MultiblockAbility.IMPORT_ITEMS
import gregtech.api.metatileentity.multiblock.MultiblockAbility.INPUT_ENERGY
import gregtech.api.metatileentity.multiblock.MultiblockAbility.INPUT_LASER
import gregtech.api.metatileentity.multiblock.MultiblockAbility.SUBSTATION_INPUT_ENERGY
import gregtech.api.metatileentity.multiblock.MultiblockWithDisplayBase
import gregtech.api.pattern.BlockPattern
import gregtech.api.pattern.FactoryBlockPattern
import gregtech.api.pattern.PatternMatchContext
import gregtech.api.pattern.TraceabilityPredicate
import gregtech.api.unification.material.Materials.Neutronium
import gregtech.api.util.RelativeDirection.DOWN
import gregtech.api.util.RelativeDirection.FRONT
import gregtech.api.util.RelativeDirection.RIGHT
import gregtech.client.renderer.ICubeRenderer
import gregtechlite.gtlitecore.api.GTLiteAPI.ACCELERATION_TRACK_TIER
import gregtechlite.gtlitecore.api.SECOND
import gregtechlite.gtlitecore.api.capability.ModuleProvider
import gregtechlite.gtlitecore.api.capability.ModuleReceiver
import gregtechlite.gtlitecore.api.pattern.TraceabilityPredicates.accelerationTracks
import gregtechlite.gtlitecore.api.pattern.TraceabilityPredicates.getAttributeOrDefault
import gregtechlite.gtlitecore.client.renderer.texture.GTLiteTextures
import gregtechlite.gtlitecore.common.block.variant.aerospace.AerospaceCasing
import net.minecraft.client.resources.I18n
import net.minecraft.item.ItemStack
import net.minecraft.nbt.NBTTagCompound
import net.minecraft.network.PacketBuffer
import net.minecraft.util.ResourceLocation
import net.minecraft.world.World
import net.minecraftforge.fml.relauncher.Side
import net.minecraftforge.fml.relauncher.SideOnly
import java.util.concurrent.ConcurrentHashMap

class MultiblockSpaceElevator(id: ResourceLocation)
    : MultiblockWithDisplayBase(id), ModuleProvider
{

    private val moduleReceivers = ConcurrentHashMap.newKeySet<ModuleReceiver>()

    private var energyContainer: IEnergyContainer? = null
    override var computationProvider: IOpticalComputationProvider? = null
    override val subEnergyContainer: IEnergyContainer?
        get() = this.energyContainer

    override var casingTier: Int = 0
        private set

    private var isExtended = false

    companion object
    {
        private val casingState = AerospaceCasing.ELEVATOR_BASE_CASING.state
        private val secondCasingState = AerospaceCasing.INTERNAL_STRUCTURE_CASING.state
        private val thirdCasingState = AerospaceCasing.SUPPORT_STRUCTURE_CASING.state
        private val fourthCasingState = AerospaceCasing.HIGH_STRENGTH_CONCRETE.state
    }

    override fun createMetaTileEntity(tileEntity: IGregTechTileEntity) = MultiblockSpaceElevator(metaTileEntityId)

    override fun update()
    {
        super.update()
        if (!isStructureFormed)
            moduleReceivers.forEach { it.sentWorkingDisabled() }
    }
    
    override fun updateFormedValid()
    {
        if (!moduleReceivers.isEmpty())
        {
            if (!checkModules()) invalidateStructure()
        }
        if (offsetTimer % SECOND == 0L)
        {
            moduleReceivers.removeIf { it.moduleProvider == null }
        }
    }
    
    override fun formStructure(context: PatternMatchContext)
    {
        super.formStructure(context)
        initializeAbilities()
        casingTier = context.getAttributeOrDefault(ACCELERATION_TRACK_TIER, 0)
    }
    
    override fun invalidateStructure()
    {
        super.invalidateStructure()
        resetTileAbilities()
        this.casingTier = 0
        moduleReceivers.forEach { it.sentWorkingDisabled() }
        moduleReceivers.forEach { it.moduleProvider = null }
    }
    
    override fun checkStructurePattern()
    {
        super.checkStructurePattern()
        if (offsetTimer % (5 * SECOND) == 0L || isFirstTick)
        {
            if (!isStructureFormed) reinitializeStructurePattern()
            super.checkStructurePattern()
        }
    }
    
    private fun initializeAbilities()
    {
        val inputEnergy = ArrayList(getAbilities(INPUT_ENERGY))
        inputEnergy.addAll(getAbilities(SUBSTATION_INPUT_ENERGY))
        inputEnergy.addAll(getAbilities(INPUT_LASER))
        this.energyContainer = EnergyContainerList(inputEnergy)
        
        val inputComputation = getAbilities(COMPUTATION_DATA_RECEPTION)
        if (inputComputation != null && !inputComputation.isEmpty())
            computationProvider = inputComputation[0]
    }
    
    private fun resetTileAbilities()
    {
        energyContainer = EnergyContainerList(ArrayList())
    }

    // @formatter:off

    override fun createStructurePattern(): BlockPattern
    {
        if (!isExtended)
        {
            return FactoryBlockPattern.start(RIGHT, DOWN, FRONT)
                .aisle("                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "               FF FF               ", "               AAAAA               ")
                .aisle("                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "               D   D               ", "            FFFFF FFFFF            ", "            AAAAAAAAAAA            ")
                .aisle("                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "            DDDDE EDDDD            ", "          FFFFFFF FFFFFFF          ", "          AAAAAAAAAAAAAAA          ")
                .aisle("                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                E E                ", "          DD   DE ED   DD          ", "         FFFFFFD   DFFFFFF         ", "        AAAAAAAAAAAAAAAAAAA        ")
                .aisle("                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                E E                ", "               DE ED               ", "               D   D               ", "         FFF           FFF         ", "       AAAAAAAAAAAAAAAAAAAAA       ")
                .aisle("                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                E E                ", "               DE ED               ", "               DE ED               ", "                                   ", "                                   ", "      AAAAAAAAAAAAAAAAAAAAAAA      ")
                .aisle("                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                E E                ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "                                   ", "                                   ", "                                   ", "     AAAAAAAAAAAAAAAAAAAAAAAAA     ")
                .aisle("                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                E E                ", "              HDE EDH              ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "    AAAAAAAAAAAAAAAAAAAAAAAAAAA    ")
                .aisle("                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                E E                ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "            HH DE ED HH            ", "                                   ", "                                   ", "                                   ", "                                   ", "               V V V               ", "               V V V               ", "               V V V               ", "               V V V               ", "   AAAAAAAAAAAAV V VAAAAAAAAAAAA   ")
                .aisle("                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                E E                ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "                                   ", "         E               E         ", "         EHH           HHE         ", "         E               E         ", "         E               E         ", "         E               E         ", "         E               E         ", "         E     V V V     E         ", "         E     I I I     E         ", "         E     V V V     E         ", "   FF    E     V V V     E    FF   ", "   AAAAAAAAAAAAV V VAAAAAAAAAAAA   ")
                .aisle("                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                E E                ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "          E             E          ", "          E             E          ", "          E             E          ", "          E             E          ", "          E             E          ", "         HE             EH         ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "   D                           D   ", "  FFF          F F F          FFF  ", "  AAAAAAAAAAAAA     AAAAAAAAAAAAA  ")
                .aisle("                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                E E                ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "                                   ", "                                   ", "           E           E           ", "           E           E           ", "           E           E           ", "           E           E           ", "           E           E           ", "                                   ", "                                   ", "         H               H         ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "   D                           D   ", "  FFF          F F F          FFF  ", "  AAAAAAAAAAAAA     AAAAAAAAAAAAA  ")
                .aisle("                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                E E                ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "             HH     HH             ", "            E         E            ", "            E         E            ", "            E         E            ", "            E         E            ", "            E         E            ", "            E         E            ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "        H                 H        ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "  D                             D  ", " FFF          FFFFFFF          FFF ", " AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA ")
                .aisle("                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                FFF                ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "             E       E             ", "             E       E             ", "             E       E             ", "             E       E             ", "             E       E             ", "             E       E             ", "             E       E             ", "            HE       EH            ", "             E       E             ", "             E       E             ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "        H                 H        ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "  D                             D  ", " FFF         FFFFFFFFF         FFF ", " AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA ")
                .aisle("                FFF                ", "                 E                 ", "                 E                 ", "                 E                 ", "                 E                 ", "                 E                 ", "               F   F               ", "              E     E              ", "              E     E              ", "              E     E              ", "              E     E              ", "              E     E              ", "              E     E              ", "              E     E              ", "              E     E              ", "              E     E              ", "                                   ", "                                   ", "                FFF                ", "                                   ", "                                   ", "            H         H            ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                FFF                ", "                                   ", "                                   ", "                                   ", "                                   ", "       H                   H       ", "                                   ", "                                   ", "                                   ", "                                   ", "                XXX                ", "                X~X                ", "  D             XXX             D  ", " FFF        FFFFFFFFFFF        FFF ", " AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA ")
                .aisle("               F D F               ", "                 D                 ", "                 D                 ", "                 D                 ", "                 D                 ", "                 D                 ", "              F  D  F              ", "                 D                 ", "            D    D    D            ", "            D    D    D            ", "            D    D    D            ", "            D    D    D            ", "            D    D    D            ", "            D    D    D            ", "            D    D    D            ", "           DD    D    DD           ", "           D     D     D           ", "           D     D     D           ", "           D   F D F   D           ", "           D     C     D           ", "           D     C     D           ", "           D     C     D           ", "           D     C     D           ", "          DD     C     DD          ", "          D      C      D          ", "          D      C      D          ", "          D      C      D          ", "         DD      C      DD         ", "         D     FDCDF     D         ", "         D      DCD      D         ", "        DD      DCD      DD        ", "        D       DCD       D        ", "        D       DCD       D        ", "       DD      DDCDD      DD       ", "       D       D C D       D       ", "       D       D C D       D       ", "      DD       D C D       DD      ", "      D        D C D        D      ", "     DD VV     XDCDX     VV DD     ", "    DD  VI     XDCDX     IV  DD    ", " DDDD   VV     XDCDX     VV   DDDD ", "FFFD    VVFFFFFDDDDDFFFFFVV    DFFF", "AAAAAAAAVV  AAAXXXXXAAA  VVAAAAAAAA")
                .aisle("              F     F              ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "             F       F             ", "            E         E            ", "            E         E            ", "            E         E            ", "            E         E            ", "            E         E            ", "            E         E            ", "            E         E            ", "           EE         EE           ", "           EE         EE           ", "           E           E           ", "           E           E           ", "           E  F     F  E           ", "           E           E           ", "           E           E           ", "           E           E           ", "          EE           EE          ", "          EE           EE          ", "          E             E          ", "          E             E          ", "         EE             EE         ", "         EE             EE         ", "         E    FD   DF    E         ", "        EE     D   D     EE        ", "        EE     D   D     EE        ", "        E      D   D      E        ", "       EE      D   D      EE       ", "       EE      D   D      EE       ", "       E                   E       ", "      EE                   EE      ", "      EE                   EE      ", "     EE                     EE     ", "    EEE       XD   DX       EEE    ", "   EEE        XD   DX        EEE   ", "  EE          XD   DX          EE  ", "FFF         FFFDDDDDFFF         FFF", "AAAAAAAA    AAAXXXXXAAA    AAAAAAAA")
                .aisle("              FD   DF              ", "              ED   DE              ", "              ED   DE              ", "              ED   DE              ", "              ED   DE              ", "              ED   DE              ", "             F D   D F             ", "               D   D               ", "               D   D               ", "               D   D               ", "               D   D               ", "               D   D               ", "               D   D               ", "               D   D               ", "               D   D               ", "               D   D               ", "               D   D               ", "               D B D               ", "              FD - DF              ", "               C - C               ", "               C - C               ", "               C - C               ", "               C - C               ", "               C - C               ", "               C - C               ", "               C - C               ", "               C - C               ", "               C - C               ", "              FC - CF              ", "               C - C               ", "               C - C               ", "               C - C               ", "               C - C               ", "               C - C               ", "               C - C               ", "               C - C               ", "               C - C               ", "               C - C               ", "        VV    XC - CX    VV        ", "        VI    XC - CX    IV        ", "        VV    XC - CX    VV        ", "        VVFFFFFDDDDDFFFFFVV        ", "AAAAAAAAVV  AAAXXXXXAAA  VVAAAAAAAA")
                .aisle("              F     F              ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "             F       F             ", "            E         E            ", "            E         E            ", "            E         E            ", "            E         E            ", "            E         E            ", "            E         E            ", "            E         E            ", "           EE         EE           ", "           EE         EE           ", "           E           E           ", "           E           E           ", "           E  F     F  E           ", "           E           E           ", "           E           E           ", "           E           E           ", "          EE           EE          ", "          EE           EE          ", "          E             E          ", "          E             E          ", "         EE             EE         ", "         EE             EE         ", "         E    FD   DF    E         ", "        EE     D   D     EE        ", "        EE     D   D     EE        ", "        E      D   D      E        ", "       EE      D   D      EE       ", "       EE      D   D      EE       ", "       E                   E       ", "      EE                   EE      ", "      EE                   EE      ", "     EE                     EE     ", "    EEE       XD   DX       EEE    ", "   EEE        XD   DX        EEE   ", "  EE          XD   DX          EE  ", "FFF         FFFDDDDDFFF         FFF", "AAAAAAAA    AAAXXXXXAAA    AAAAAAAA")
                .aisle("               F D F               ", "                 D                 ", "                 D                 ", "                 D                 ", "                 D                 ", "                 D                 ", "              F  D  F              ", "                 D                 ", "            D    D    D            ", "            D    D    D            ", "            D    D    D            ", "            D    D    D            ", "            D    D    D            ", "            D    D    D            ", "            D    D    D            ", "           DD    D    DD           ", "           D     D     D           ", "           D     D     D           ", "           D   F D F   D           ", "           D     C     D           ", "           D     C     D           ", "           D     C     D           ", "           D     C     D           ", "          DD     C     DD          ", "          D      C      D          ", "          D      C      D          ", "          D      C      D          ", "         DD      C      DD         ", "         D     FDCDF     D         ", "         D      DCD      D         ", "        DD      DCD      DD        ", "        D       DCD       D        ", "        D       DCD       D        ", "       DD      DDCDD      DD       ", "       D       D C D       D       ", "       D       D C D       D       ", "      DD       D C D       DD      ", "      D        D C D        D      ", "     DD VV     XDCDX     VV DD     ", "    DD  VI     XDCDX     IV  DD    ", " DDDD   VV     XDCDX     VV   DDDD ", "FFFD    VVFFFFFDDDDDFFFFFVV    DFFF", "AAAAAAAAVV  AAAXXXXXAAA  VVAAAAAAAA")
                .aisle("                FFF                ", "                 E                 ", "                 E                 ", "                 E                 ", "                 E                 ", "                 E                 ", "               F   F               ", "              E     E              ", "              E     E              ", "              E     E              ", "              E     E              ", "              E     E              ", "              E     E              ", "              E     E              ", "              E     E              ", "              E     E              ", "                                   ", "                                   ", "                FFF                ", "                                   ", "                                   ", "            H         H            ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                FFF                ", "                                   ", "                                   ", "                                   ", "                                   ", "       H                   H       ", "                                   ", "                                   ", "                                   ", "                                   ", "                XXX                ", "                XXX                ", "  D             XXX             D  ", " FFF        FFFFFFFFFFF        FFF ", " AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA ")
                .aisle("                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                FFF                ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "             E       E             ", "             E       E             ", "             E       E             ", "             E       E             ", "             E       E             ", "             E       E             ", "             E       E             ", "            HE       EH            ", "             E       E             ", "             E       E             ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "        H                 H        ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "  D                             D  ", " FFF         FFFFFFFFF         FFF ", " AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA ")
                .aisle("                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                E E                ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "             HH     HH             ", "            E         E            ", "            E         E            ", "            E         E            ", "            E         E            ", "            E         E            ", "            E         E            ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "        H                 H        ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "  D                             D  ", " FFF          FFFFFFF          FFF ", " AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA ")
                .aisle("                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                E E                ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "                                   ", "                                   ", "           E           E           ", "           E           E           ", "           E           E           ", "           E           E           ", "           E           E           ", "                                   ", "                                   ", "         H               H         ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "   D                           D   ", "  FFF          F F F          FFF  ", "  AAAAAAAAAAAAA     AAAAAAAAAAAAA  ")
                .aisle("                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                E E                ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "          E             E          ", "          E             E          ", "          E             E          ", "          E             E          ", "          E             E          ", "         HE             EH         ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "   D                           D   ", "  FFF          F F F          FFF  ", "  AAAAAAAAAAAAA     AAAAAAAAAAAAA  ")
                .aisle("                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                E E                ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "                                   ", "         E               E         ", "         EHH           HHE         ", "         E               E         ", "         E               E         ", "         E               E         ", "         E               E         ", "         E     V V V     E         ", "         E     I I I     E         ", "         E     V V V     E         ", "   FF    E     V V V     E    FF   ", "   AAAAAAAAAAAAV V VAAAAAAAAAAAA   ")
                .aisle("                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                E E                ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "            HH DE ED HH            ", "                                   ", "                                   ", "                                   ", "                                   ", "               V V V               ", "               V V V               ", "               V V V               ", "               V V V               ", "   AAAAAAAAAAAAV V VAAAAAAAAAAAA   ")
                .aisle("                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                E E                ", "              HDE EDH              ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "    AAAAAAAAAAAAAAAAAAAAAAAAAAA    ")
                .aisle("                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                E E                ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "                                   ", "                                   ", "                                   ", "     AAAAAAAAAAAAAAAAAAAAAAAAA     ")
                .aisle("                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                E E                ", "               DE ED               ", "               DE ED               ", "                                   ", "                                   ", "      AAAAAAAAAAAAAAAAAAAAAAA      ")
                .aisle("                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                E E                ", "               DE ED               ", "               D   D               ", "         FFF           FFF         ", "       AAAAAAAAAAAAAAAAAAAAA       ")
                .aisle("                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                E E                ", "          DD   DE ED   DD          ", "         FFFFFFD   DFFFFFF         ", "        AAAAAAAAAAAAAAAAAAA        ")
                .aisle("                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "            DDDDE EDDDD            ", "          FFFFFFF FFFFFFF          ", "          AAAAAAAAAAAAAAA          ")
                .aisle("                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "               D   D               ", "            FFFFF FFFFF            ", "            AAAAAAAAAAA            ")
                .aisle("                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "               FF FF               ", "               AAAAA               ")
                .where('~', selfPredicate())
                .where('D', states(casingState))
                .where('F', states(secondCasingState))
                .where('E', states(thirdCasingState))
                .where('A', states(fourthCasingState))
                .where('H', frames(Neutronium))
                .where('X', states(casingState)
                    .or(abilities(INPUT_ENERGY)
                            .setMaxGlobalLimited(2)
                            .setPreviewCount(1))
                    .or(abilities(INPUT_LASER)
                            .setMaxGlobalLimited(1)
                            .setPreviewCount(0))
                    .or(abilities(COMPUTATION_DATA_RECEPTION)
                            .setMaxGlobalLimited(1)
                            .setPreviewCount(1)))
                .where('V', states(casingState)
                    .or(abilities(IMPORT_ITEMS, IMPORT_FLUIDS, EXPORT_ITEMS, EXPORT_FLUIDS, COMPUTATION_DATA_RECEPTION)
                            .setPreviewCount(0)))
                .where('C', accelerationTracks())
                .where('I', states(casingState)
                    .or(modulePredicate()))
                .where(' ', any())
                .where('-', air())
                .where('B', air()) // TODO A renderer block (space elevator cable)?
                .build()
        }
        else
        {
            return FactoryBlockPattern.start(RIGHT, DOWN, FRONT)
                .aisle("                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                    FFFFFFF                    ", "                    AAAAAAA                    ")
                .aisle("                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                     V V V                     ", "                     V V V                     ", "                     V V V                     ", "                   FFV V VFF                   ", "                 AAAAV V VAAAA                 ")
                .aisle("                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                     V V V                     ", "                     I I I                     ", "                     V V V                     ", "                   FFV V VFF                   ", "              AAAAAAAV V VAAAAAAA              ")
                .aisle("                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                   FFF F FFF                   ", "            AAAAAAAAAA   AAAAAAAAAA            ")
                .aisle("                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                  FFFF F FFFF                  ", "          AAAA   AAAAA   AAAAA   AAAA          ")
                .aisle("                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                  FFFF F FFFF                  ", "        AAAA     AAAAA   AAAAA     AAAA        ")
                .aisle("                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                  FFFFFFFFFFF                  ", "       AAA      AAAAAAAAAAAAAAA      AAA       ")
                .aisle("                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                     D   D                     ", "                  FFFFF FFFFF                  ", "      AAA       AAAAAAAAAAAAAAA       AAA      ")
                .aisle("                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                  DDDDE EDDDD                  ", "                FFFFFFF FFFFFFF                ", "     AAA        AAAAAAAAAAAAAAA        AAA     ")
                .aisle("                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                      E E                      ", "                DD   DE ED   DD                ", "               FFFFFFD   DFFFFFF               ", "     AA       AAAAAAAAAAAAAAAAAAA       AA     ")
                .aisle("                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                      E E                      ", "                     DE ED                     ", "                     D   D                     ", "               FFF           FFF               ", "    AA       AAAAAAAAAAAAAAAAAAAAA       AA    ")
                .aisle("                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                      E E                      ", "                     DE ED                     ", "                     DE ED                     ", "                                               ", "                                               ", "    AA      AAAAAAAAAAAAAAAAAAAAAAA      AA    ")
                .aisle("                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                      E E                      ", "                     DE ED                     ", "                     DE ED                     ", "                     DE ED                     ", "                                               ", "                                               ", "                                               ", "   AA      AAAAAAAAAAAAAAAAAAAAAAAAA      AA   ")
                .aisle("                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                      E E                      ", "                    HDE EDH                    ", "                     DE ED                     ", "                     DE ED                     ", "                     DE ED                     ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "   AA     AAAAAAAAAAAAAAAAAAAAAAAAAAA     AA   ")
                .aisle("                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                      E E                      ", "                     DE ED                     ", "                     DE ED                     ", "                     DE ED                     ", "                  HH DE ED HH                  ", "                                               ", "                                               ", "                                               ", "                                               ", "                     V V V                     ", "                     V V V                     ", "                     V V V                     ", "                     V V V                     ", "  AA     AAAAAAAAAAAAV V VAAAAAAAAAAAA     AA  ")
                .aisle("                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                      E E                      ", "                     DE ED                     ", "                     DE ED                     ", "                     DE ED                     ", "                     DE ED                     ", "                                               ", "               E               E               ", "               EHH           HHE               ", "               E               E               ", "               E               E               ", "               E               E               ", "               E               E               ", "               E     V V V     E               ", "               E     I I I     E               ", "               E     V V V     E               ", "         FF    E     V V V     E    FF         ", "  AA     AAAAAAAAAAAAV V VAAAAAAAAAAAA     AA  ")
                .aisle("                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                      E E                      ", "                     DE ED                     ", "                     DE ED                     ", "                     DE ED                     ", "                     DE ED                     ", "                     DE ED                     ", "                E             E                ", "                E             E                ", "                E             E                ", "                E             E                ", "                E             E                ", "               HE             EH               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "         D                           D         ", "        FFF          F F F          FFF        ", "  AA  AAAAAAAAAAAAAAA     AAAAAAAAAAAAAAA  AA  ")
                .aisle("                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                      E E                      ", "                     DE ED                     ", "                     DE ED                     ", "                     DE ED                     ", "                     DE ED                     ", "                     DE ED                     ", "                     DE ED                     ", "                     DE ED                     ", "                     DE ED                     ", "                     DE ED                     ", "                                               ", "                                               ", "                 E           E                 ", "                 E           E                 ", "                 E           E                 ", "                 E           E                 ", "                 E           E                 ", "                                               ", "                                               ", "               H               H               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "         D                           D         ", "        FFF          F F F          FFF        ", " AAAAAAAAAAAAAAAAAAAA     AAAAAAAAAAAAAAAAAAAA ")
                .aisle("                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                      E E                      ", "                     DE ED                     ", "                     DE ED                     ", "                     DE ED                     ", "                     DE ED                     ", "                     DE ED                     ", "                     DE ED                     ", "                     DE ED                     ", "                     DE ED                     ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                   HH     HH                   ", "                  E         E                  ", "                  E         E                  ", "                  E         E                  ", "                  E         E                  ", "                  E         E                  ", "                  E         E                  ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "              H                 H              ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "        D                             D        ", "    FFFFFF          FFFFFFF          FFFFFF    ", " AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA ")
                .aisle("                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                      FFF                      ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                   E       E                   ", "                   E       E                   ", "                   E       E                   ", "                   E       E                   ", "                   E       E                   ", "                   E       E                   ", "                   E       E                   ", "                  HE       EH                  ", "                   E       E                   ", "                   E       E                   ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "              H                 H              ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "        D                             D        ", " FFFFFFFFF         FFFFFFFFF         FFFFFFFFF ", " AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA ")
                .aisle("                      FFF                      ", "                       E                       ", "                       E                       ", "                       E                       ", "                       E                       ", "                       E                       ", "                     F   F                     ", "                    E     E                    ", "                    E     E                    ", "                    E     E                    ", "                    E     E                    ", "                    E     E                    ", "                    E     E                    ", "                    E     E                    ", "                    E     E                    ", "                    E     E                    ", "                                               ", "                                               ", "                      FFF                      ", "                                               ", "                                               ", "                  H         H                  ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                      FFF                      ", "                                               ", "                                               ", "                                               ", "                                               ", "             H                   H             ", "                                               ", "                                               ", "                                               ", "                                               ", "                      XXX                      ", "                      X~X                      ", "        D             XXX             D        ", "FFFFFFFFFF        FFFFFFFFFFF        FFFFFFFFFF", "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA")
                .aisle("                     F D F                     ", "                       D                       ", "                       D                       ", "                       D                       ", "                       D                       ", "                       D                       ", "                    F  D  F                    ", "                       D                       ", "                  D    D    D                  ", "                  D    D    D                  ", "                  D    D    D                  ", "                  D    D    D                  ", "                  D    D    D                  ", "                  D    D    D                  ", "                  D    D    D                  ", "                 DD    D    DD                 ", "                 D     D     D                 ", "                 D     D     D                 ", "                 D   F D F   D                 ", "                 D     C     D                 ", "                 D     C     D                 ", "                 D     C     D                 ", "                 D     C     D                 ", "                DD     C     DD                ", "                D      C      D                ", "                D      C      D                ", "                D      C      D                ", "               DD      C      DD               ", "               D     FDCDF     D               ", "               D      DCD      D               ", "              DD      DCD      DD              ", "              D       DCD       D              ", "              D       DCD       D              ", "             DD      DDCDD      DD             ", "             D       D C D       D             ", "             D       D C D       D             ", "            DD       D C D       DD            ", "            D        D C D        D            ", " VV        DD VV     XDCDX     VV DD        VV ", " VI       DD  VI     XDCDX     IV  DD       IV ", " VV    DDDD   VV     XDCDX     VV   DDDD    VV ", "FVVFFFFFFD    VVFFFFFDDDDDFFFFFVV    DFFFFFFVVF", "AVVAAAAAAAAAAAVV  AAAXXXXXAAA  VVAAAAAAAAAAAVVA")
                .aisle("                    F     F                    ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                   F       F                   ", "                  E         E                  ", "                  E         E                  ", "                  E         E                  ", "                  E         E                  ", "                  E         E                  ", "                  E         E                  ", "                  E         E                  ", "                 EE         EE                 ", "                 EE         EE                 ", "                 E           E                 ", "                 E           E                 ", "                 E  F     F  E                 ", "                 E           E                 ", "                 E           E                 ", "                 E           E                 ", "                EE           EE                ", "                EE           EE                ", "                E             E                ", "                E             E                ", "               EE             EE               ", "               EE             EE               ", "               E    FD   DF    E               ", "              EE     D   D     EE              ", "              EE     D   D     EE              ", "              E      D   D      E              ", "             EE      D   D      EE             ", "             EE      D   D      EE             ", "             E                   E             ", "            EE                   EE            ", "            EE                   EE            ", "           EE                     EE           ", "          EEE       XD   DX       EEE          ", "         EEE        XD   DX        EEE         ", "        EE          XD   DX          EE        ", "F     FFF         FFFDDDDDFFF         FFF     F", "A     AAAAAAAA    AAAXXXXXAAA    AAAAAAAA     A")
                .aisle("                    FD   DF                    ", "                    ED   DE                    ", "                    ED   DE                    ", "                    ED   DE                    ", "                    ED   DE                    ", "                    ED   DE                    ", "                   F D   D F                   ", "                     D   D                     ", "                     D   D                     ", "                     D   D                     ", "                     D   D                     ", "                     D   D                     ", "                     D   D                     ", "                     D   D                     ", "                     D   D                     ", "                     D   D                     ", "                     D   D                     ", "                     D B D                     ", "                    FD - DF                    ", "                     C - C                     ", "                     C - C                     ", "                     C - C                     ", "                     C - C                     ", "                     C - C                     ", "                     C - C                     ", "                     C - C                     ", "                     C - C                     ", "                     C - C                     ", "                    FC - CF                    ", "                     C - C                     ", "                     C - C                     ", "                     C - C                     ", "                     C - C                     ", "                     C - C                     ", "                     C - C                     ", "                     C - C                     ", "                     C - C                     ", "                     C - C                     ", " VV           VV    XC - CX    VV           VV ", " VI           VI    XC - CX    IV           IV ", " VV           VV    XC - CX    VV           VV ", "FVVFFFF       VVFFFFFDDDDDFFFFFVV       FFFFVVF", "AVV   AAAAAAAAVV  AAAXXXXXAAA  VVAAAAAAAA   VVA")
                .aisle("                    F     F                    ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                   F       F                   ", "                  E         E                  ", "                  E         E                  ", "                  E         E                  ", "                  E         E                  ", "                  E         E                  ", "                  E         E                  ", "                  E         E                  ", "                 EE         EE                 ", "                 EE         EE                 ", "                 E           E                 ", "                 E           E                 ", "                 E  F     F  E                 ", "                 E           E                 ", "                 E           E                 ", "                 E           E                 ", "                EE           EE                ", "                EE           EE                ", "                E             E                ", "                E             E                ", "               EE             EE               ", "               EE             EE               ", "               E    FD   DF    E               ", "              EE     D   D     EE              ", "              EE     D   D     EE              ", "              E      D   D      E              ", "             EE      D   D      EE             ", "             EE      D   D      EE             ", "             E                   E             ", "            EE                   EE            ", "            EE                   EE            ", "           EE                     EE           ", "          EEE       XD   DX       EEE          ", "         EEE        XD   DX        EEE         ", "        EE          XD   DX          EE        ", "F     FFF         FFFDDDDDFFF         FFF     F", "A     AAAAAAAA    AAAXXXXXAAA    AAAAAAAA     A")
                .aisle("                     F D F                     ", "                       D                       ", "                       D                       ", "                       D                       ", "                       D                       ", "                       D                       ", "                    F  D  F                    ", "                       D                       ", "                  D    D    D                  ", "                  D    D    D                  ", "                  D    D    D                  ", "                  D    D    D                  ", "                  D    D    D                  ", "                  D    D    D                  ", "                  D    D    D                  ", "                 DD    D    DD                 ", "                 D     D     D                 ", "                 D     D     D                 ", "                 D   F D F   D                 ", "                 D     C     D                 ", "                 D     C     D                 ", "                 D     C     D                 ", "                 D     C     D                 ", "                DD     C     DD                ", "                D      C      D                ", "                D      C      D                ", "                D      C      D                ", "               DD      C      DD               ", "               D     FDCDF     D               ", "               D      DCD      D               ", "              DD      DCD      DD              ", "              D       DCD       D              ", "              D       DCD       D              ", "             DD      DDCDD      DD             ", "             D       D C D       D             ", "             D       D C D       D             ", "            DD       D C D       DD            ", "            D        D C D        D            ", " VV        DD VV     XDCDX     VV DD        VV ", " VI       DD  VI     XDCDX     IV  DD       IV ", " VV    DDDD   VV     XDCDX     VV   DDDD    VV ", "FVVFFFFFFD    VVFFFFFDDDDDFFFFFVV    DFFFFFFVVF", "AVVAAAAAAAAAAAVV  AAAXXXXXAAA  VVAAAAAAAAAAAVVA")
                .aisle("                      FFF                      ", "                       E                       ", "                       E                       ", "                       E                       ", "                       E                       ", "                       E                       ", "                     F   F                     ", "                    E     E                    ", "                    E     E                    ", "                    E     E                    ", "                    E     E                    ", "                    E     E                    ", "                    E     E                    ", "                    E     E                    ", "                    E     E                    ", "                    E     E                    ", "                                               ", "                                               ", "                      FFF                      ", "                                               ", "                                               ", "                  H         H                  ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                      FFF                      ", "                                               ", "                                               ", "                                               ", "                                               ", "             H                   H             ", "                                               ", "                                               ", "                                               ", "                                               ", "                      XXX                      ", "                      XXX                      ", "        D             XXX             D        ", "FFFFFFFFFF        FFFFFFFFFFF        FFFFFFFFFF", "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA")
                .aisle("                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                      FFF                      ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                   E       E                   ", "                   E       E                   ", "                   E       E                   ", "                   E       E                   ", "                   E       E                   ", "                   E       E                   ", "                   E       E                   ", "                  HE       EH                  ", "                   E       E                   ", "                   E       E                   ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "              H                 H              ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "        D                             D        ", " FFFFFFFFF         FFFFFFFFF         FFFFFFFFF ", " AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA ")
                .aisle("                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                      E E                      ", "                     DE ED                     ", "                     DE ED                     ", "                     DE ED                     ", "                     DE ED                     ", "                     DE ED                     ", "                     DE ED                     ", "                     DE ED                     ", "                     DE ED                     ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                   HH     HH                   ", "                  E         E                  ", "                  E         E                  ", "                  E         E                  ", "                  E         E                  ", "                  E         E                  ", "                  E         E                  ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "              H                 H              ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "        D                             D        ", "    FFFFFF          FFFFFFF          FFFFFF    ", " AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA ")
                .aisle("                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                      E E                      ", "                     DE ED                     ", "                     DE ED                     ", "                     DE ED                     ", "                     DE ED                     ", "                     DE ED                     ", "                     DE ED                     ", "                     DE ED                     ", "                     DE ED                     ", "                     DE ED                     ", "                                               ", "                                               ", "                 E           E                 ", "                 E           E                 ", "                 E           E                 ", "                 E           E                 ", "                 E           E                 ", "                                               ", "                                               ", "               H               H               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "         D                           D         ", "        FFF          F F F          FFF        ", " AAAAAAAAAAAAAAAAAAAA     AAAAAAAAAAAAAAAAAAAA ")
                .aisle("                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                      E E                      ", "                     DE ED                     ", "                     DE ED                     ", "                     DE ED                     ", "                     DE ED                     ", "                     DE ED                     ", "                E             E                ", "                E             E                ", "                E             E                ", "                E             E                ", "                E             E                ", "               HE             EH               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "         D                           D         ", "        FFF          F F F          FFF        ", "  AA  AAAAAAAAAAAAAAA     AAAAAAAAAAAAAAA  AA  ")
                .aisle("                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                      E E                      ", "                     DE ED                     ", "                     DE ED                     ", "                     DE ED                     ", "                     DE ED                     ", "                                               ", "               E               E               ", "               EHH           HHE               ", "               E               E               ", "               E               E               ", "               E               E               ", "               E               E               ", "               E     V V V     E               ", "               E     I I I     E               ", "               E     V V V     E               ", "         FF    E     V V V     E    FF         ", "  AA     AAAAAAAAAAAAV V VAAAAAAAAAAAA     AA  ")
                .aisle("                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                      E E                      ", "                     DE ED                     ", "                     DE ED                     ", "                     DE ED                     ", "                  HH DE ED HH                  ", "                                               ", "                                               ", "                                               ", "                                               ", "                     V V V                     ", "                     V V V                     ", "                     V V V                     ", "                     V V V                     ", "  AA     AAAAAAAAAAAAV V VAAAAAAAAAAAA     AA  ")
                .aisle("                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                      E E                      ", "                    HDE EDH                    ", "                     DE ED                     ", "                     DE ED                     ", "                     DE ED                     ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "   AA     AAAAAAAAAAAAAAAAAAAAAAAAAAA     AA   ")
                .aisle("                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                      E E                      ", "                     DE ED                     ", "                     DE ED                     ", "                     DE ED                     ", "                                               ", "                                               ", "                                               ", "   AA      AAAAAAAAAAAAAAAAAAAAAAAAA      AA   ")
                .aisle("                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                      E E                      ", "                     DE ED                     ", "                     DE ED                     ", "                                               ", "                                               ", "    AA      AAAAAAAAAAAAAAAAAAAAAAA      AA    ")
                .aisle("                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                      E E                      ", "                     DE ED                     ", "                     D   D                     ", "               FFF           FFF               ", "    AA       AAAAAAAAAAAAAAAAAAAAA       AA    ")
                .aisle("                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                      E E                      ", "                DD   DE ED   DD                ", "               FFFFFFD   DFFFFFF               ", "     AA       AAAAAAAAAAAAAAAAAAA       AA     ")
                .aisle("                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                  DDDDE EDDDD                  ", "                FFFFFFF FFFFFFF                ", "     AAA        AAAAAAAAAAAAAAA        AAA     ")
                .aisle("                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                     D   D                     ", "                  FFFFF FFFFF                  ", "      AAA       AAAAAAAAAAAAAAA       AAA      ")
                .aisle("                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                  FFFFFFFFFFF                  ", "       AAA      AAAAAAAAAAAAAAA      AAA       ")
                .aisle("                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                  FFFF F FFFF                  ", "        AAAA     AAAAA   AAAAA     AAAA        ")
                .aisle("                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                  FFFF F FFFF                  ", "          AAAA   AAAAA   AAAAA   AAAA          ")
                .aisle("                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                   FFF F FFF                   ", "            AAAAAAAAAA   AAAAAAAAAA            ")
                .aisle("                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                     V V V                     ", "                     I I I                     ", "                     V V V                     ", "                   FFV V VFF                   ", "              AAAAAAAV V VAAAAAAA              ")
                .aisle("                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                     V V V                     ", "                     V V V                     ", "                     V V V                     ", "                   FFV V VFF                   ", "                 AAAAV V VAAAA                 ")
                .aisle("                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                                               ", "                    FFFFFFF                    ", "                    AAAAAAA                    ")
                .where('~', selfPredicate())
                .where('D', states(casingState))
                .where('F', states(secondCasingState))
                .where('E', states(thirdCasingState))
                .where('A', states(fourthCasingState))
                .where('H', frames(Neutronium))
                .where('X',states(casingState)
                    .or(abilities(INPUT_ENERGY)
                            .setMaxGlobalLimited(2)
                            .setPreviewCount(1))
                    .or(abilities(INPUT_LASER)
                            .setMaxGlobalLimited(1)
                            .setPreviewCount(0))
                    .or(abilities(COMPUTATION_DATA_RECEPTION)
                            .setMaxGlobalLimited(1)
                            .setPreviewCount(1)))
                .where('V', states(casingState)
                    .or(abilities(IMPORT_ITEMS, IMPORT_FLUIDS, EXPORT_ITEMS, EXPORT_FLUIDS, COMPUTATION_DATA_RECEPTION)
                            .setPreviewCount(0)))
                .where('C', accelerationTracks())
                .where('I', states(casingState)
                    .or(modulePredicate()))
                .where(' ', any())
                .where('-', air())
                .where('B', air()) // TODO A renderer block (space elevator cable)?
                .build()
        }
    }

    // @formatter:on

    private fun modulePredicate(): TraceabilityPredicate = TraceabilityPredicate { blockWorldState ->
        val state = blockWorldState.blockState
        val block = state.block

        // Common blocks.

        // if (block is BlockSpaceElevatorCasing)
        // {
        //     val casingType: BlockSpaceElevatorCasing.CasingType? = (state.getBlock() as BlockSpaceElevatorCasing).getState(state)
        //     if (casingType === BlockSpaceElevatorCasing.CasingType.BASE_CASING) return@Predicate true
        // }

        if ((block as VariantBlock<*>).getState(state) === AerospaceCasing.ELEVATOR_BASE_CASING.state)
        {
            return@TraceabilityPredicate true
        }

        // Module mtes.
        val te = blockWorldState.getTileEntity()
        if (te !is IGregTechTileEntity) return@TraceabilityPredicate false
        
        val mte: MetaTileEntity? = (te as IGregTechTileEntity).metaTileEntity
        if (mte is ModuleProvider) return@TraceabilityPredicate false
        if (mte !is ModuleReceiver) return@TraceabilityPredicate false
        
        val moduleReceiver: ModuleReceiver = mte as ModuleReceiver
        if (moduleReceiver.moduleProvider !== this)
        {
            moduleReceiver.moduleProvider = this
            moduleReceivers.add(moduleReceiver)
        }
        true
    }

    @SideOnly(Side.CLIENT)
    override fun getBaseTexture(sourcePart: IMultiblockPart?): ICubeRenderer = GTLiteTextures.SPACE_ELEVATOR_BASE_CASING

    @SideOnly(Side.CLIENT)
    override fun getFrontOverlay(): ICubeRenderer = GTLiteTextures.SPACE_ELEVATOR_OVERLAY

    override fun renderMetaTileEntity(renderState: CCRenderState?,
                                      translation: Matrix4?,
                                      pipeline: Array<IVertexOperation?>?)
    {
        super.renderMetaTileEntity(renderState, translation, pipeline)
        this.frontOverlay.renderOrientedState(renderState, translation, pipeline,
            getFrontFacing(), true, true)
    }
    
    override fun hasMaintenanceMechanics() = false
    
    override fun writeToNBT(data: NBTTagCompound): NBTTagCompound?
    {
        data.setBoolean("isExtended", isExtended)
        return super.writeToNBT(data)
    }
    
    override fun readFromNBT(data: NBTTagCompound)
    {
        super.readFromNBT(data)
        this.isExtended = data.getBoolean("isExtended")
    }
    
    override fun writeInitialSyncData(buf: PacketBuffer)
    {
        super.writeInitialSyncData(buf)
        buf.writeBoolean(this.isExtended)
    }
    
    override fun receiveInitialSyncData(buf: PacketBuffer)
    {
        super.receiveInitialSyncData(buf)
        this.isExtended = buf.readBoolean()
    }

    // TODO FIXME
    // override fun createUITemplate(player: EntityPlayer): ModularUI.Builder? = ModularUI.builder(GuiTextures.BACKGROUND, 198, 208)
    //     .image(4, 4, 190, 117, GuiTextures.DISPLAY)
    //     .widget(IndicatorImageWidget(174, 101, 17, 17, this.logo)
    //                 .setWarningStatus(this.warningLogo) { textList -> this.addWarningText(textList) }
    //                 .setErrorStatus(this.errorLogo) { textList -> this.addErrorText(textList) })
    //     .label(9, 9, metaFullName, 0xFFFFFF)
//
    //     .widget(AdvancedTextWidget(9, 20, { textList -> this.addDisplayText(textList) }, 0xFFFFFFF)
    //     .setMaxWidthLimit(181)
    //     .setClickHandler { componentData, clickData -> this.handleDisplayClick(componentData, clickData) })
//
    //     .widget(ClickButtonWidget(173, 125, 18, 18, "") { data ->
    //         reinitializeStructurePattern()
    //         }.setButtonTexture(GTLiteGuiTextures.BUTTON_REFRESH_STRUCTURE_PATTERN)
    //         .setTooltipText("gtlitecore.machine.space_elevator.refresh_structure_pattern"))
    //     .widget(ImageCycleButtonWidget(173, 125 + 18, 18, 18, GTLiteGuiTextures.BUTTON_ELEVATOR_EXTENSION,
    //          { this.isExtended() }, { extended: Boolean -> this.setExtended(extended) })
    //     .setTooltipHoverString("gtlitecore.machine.space_elevator.extension_info"))
    //     .widget(ClickButtonWidget(173, 125 + 18 * 2, 18, 18, "") { data ->
    //         enabledAllModules() }
    //         .setButtonTexture(GTLiteGuiTextures.BUTTON_ENABLE_MODULE)
    //     .setTooltipText("gtlitecore.machine.space_elevator.enable_module"))
    //     .widget(ClickButtonWidget(173, 125 + 18 * 3 + 4, 18, 18, "") { data ->
    //         disabledAllModules() }
    //         .setButtonTexture(GTLiteGuiTextures.BUTTON_DISABLE_MODULE)
    //     .setTooltipText("gtlitecore.machine.space_elevator.disable_module"))
    //     .bindPlayerInventory(player.inventory, 125)
    //
    // override fun addDisplayText(textList: MutableList<ITextComponent?>?)
    // {
    //     MultiblockDisplayText.builder(textList, isStructureFormed)
    //     .addCustom { tl ->
    //         // Add acceleration orbit infos and modules infos for debug.
    //         if (isStructureFormed)
    //         {
    //             tl.add(translationWithColor(TextFormatting.GRAY,
    //                 "gtlitecore.machine.space_elevator.acceleration_track_tier", this.casingTier))
    //             tl.add(translationWithColor(TextFormatting.GRAY,
    //                        "gtlitecore.machine.space_elevator.max_module_count", this.maxModules))
//
    //             // Only for debug mode to test extended structure pattern checking module and
    //             // other module checking situation.
    //             if (!this.moduleReceivers.isEmpty() && ConfigHolder.misc.debug)
    //             {
    //                 val moduleNames = ArrayList<String?>()
    //                 val uniqueNames = ArrayList<String?>()
    //                 this.moduleReceivers.forEach { moduleReceiver ->
    //                     moduleNames.add(moduleReceiver.displayCountName)
    //                     if (!uniqueNames.contains(moduleNames[moduleNames.indexOf(moduleReceiver.displayCountName)]))
    //                     {
    //                         uniqueNames.add(moduleReceiver.displayCountName)
    //                     }
    //                     uniqueNames.forEach{ receiverName ->
    //                         tl.add(translationWithColor(TextFormatting.GRAY, receiverName, Collections.frequency(moduleNames, receiverName)))
    //                     }
    //                 }
    //         }
    //     }
    //     }
    // }
    
    override fun addInformation(stack: ItemStack?,
                                world: World?,
                                tooltip: MutableList<String?>,
                                advanced: Boolean)
    {
        super.addInformation(stack, world, tooltip, advanced)
        tooltip.add(I18n.format("gtlitecore.machine.space_elevator.tooltip.1"))
        tooltip.add(I18n.format("gtlitecore.machine.space_elevator.tooltip.2"))
        tooltip.add(I18n.format("gtlitecore.machine.space_elevator.tooltip.3"))
        tooltip.add(I18n.format("gtlitecore.machine.space_elevator.tooltip.4"))
        tooltip.add(I18n.format("gtlitecore.machine.space_elevator.tooltip.5"))
        tooltip.add(I18n.format("gtlitecore.machine.space_elevator.tooltip.6"))
        tooltip.add(I18n.format("gtlitecore.machine.space_elevator.tooltip.7"))
        tooltip.add(I18n.format("gtlitecore.machine.space_elevator.tooltip.8"))
    }

   //  override fun getLogo(): TextureArea = GTLiteGuiTextures.SPACE_ELEVATOR_LOGO_DARK
//
   //  override fun getWarningLogo(): TextureArea = GTLiteGuiTextures.SPACE_ELEVATOR_LOGO_BLINKING_YELLOW
//
   //  override fun getErrorLogo(): TextureArea = GTLiteGuiTextures.SPACE_ELEVATOR_LOGO_BLINKING_RED

    private fun disabledAllModules()
    {
        this.moduleReceivers.forEach { moduleReceiver -> moduleReceiver.sentWorkingDisabled()}
    }
    
    private fun enabledAllModules()
    {
        this.moduleReceivers.forEach { moduleReceiver -> moduleReceiver.sentWorkingEnabled()}
    }
    
    private fun checkModules() = this.moduleCount <= this.maxModules

    private val moduleCount: Int
        get() = moduleReceivers.size

    private val maxModules: Int
        get()
        {
            if (this.casingTier == 1) return 6
            if (this.casingTier == 2) return 12
            if (this.casingTier == 3 && isExtended) return 15
            if (this.casingTier == 4 && isExtended) return 18
            if (this.casingTier == 5 && isExtended) return 24
            return 12
        }

    private fun isExtended(): Boolean {
        return this.isExtended
    }
    
    private fun setExtended(extended: Boolean) {
        this.isExtended = extended
        invalidateStructure()
        reinitializeStructurePattern()
    }

    override fun isModule(receiver: ModuleReceiver): Boolean = moduleReceivers.contains(receiver)

}
